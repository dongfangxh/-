# 上传漏洞

```上传漏洞专题概述
在网站的运营过程中，不可避免的要对网站的某些页面或内容进行更新，这时便需要使用到网站的文件上传功能。
如果不对被上传的文件进行限制或者限制被绕过，该功能便有可能会被利用于上传可执行文件，脚本到服务器上，
进而进一步导致服务器沦陷。
    常见的漏洞分类：
        ·服务器配置不当导致文件上传
        ·开源编辑器存在上传漏洞
        ·本地文件上传限制可以被绕过
        ·服务端过滤不严可以被绕过
        ·解析漏洞导致的文件执行
        ·文件路径截断
    上传漏洞的利用成果：
        1、较为快速、直接地获取网站的web权限。
        2、配合其他漏洞达到同样获取网站权限的目的。
        3、为后续进一步渗透提供比较方便的跳板。
```




   ```IIS的写权限漏洞
 IIS写权限漏洞
    在服务器配置不当的时候，可能上传文件的页面都不需要，就可以实现文件上传功能。一般都是http请求put方法。
    当然web服务器默认是不开启put等方法的，出现该漏洞的原因主要是网站管理员对服务器的错误配置。
    常见的主要就是管理员错误的打开了IIS的服务器的WEBDAV而且没有开启权限验证，导致可以put文件到服务器再利
    用服务器的解析漏洞运行恶意代码或用WEBDAV的MOVE方法将所上传的带有恶意代码的普通文件后缀修改为可执行文
    件后缀，运行恶意代码。
    漏洞利用-从写权限到文件上传
        1、	put一个txt文件到服务器上
        2、	把文件MOVE成IIS可解析的脚本类型文件
   ```

​		

```解析漏洞
			指web服务器因对http请求处理不当导致，将不允许可执行的脚本，文件等执行。该漏洞一般配合服务器的文件
			上传功能，以获取服务器的权限。
		解析漏洞的分类：
			·IIS 5.x/6.0解析漏洞
			1、目录解析：/test.asp/1.jpg
			2、分号后不解析：test.asp;jpg
			3、默认解析：test.asa/test.cer/test.cdx
			·IIS 7.0/IIS 7.5/Nginx<0.8.3畸形解析漏洞
			·Nginx<8.03空字节代码执行漏洞
			在Fast-CGI关闭的情况下，Nginx< 8.03依然存在解析漏洞在一个文件路径			（/xx.jpg）后面加上%00.php会将/xx.jpg%00.php解析为php文件
			·Apache解析漏洞
			apache以module模式结合php存在解析漏洞，Apache是从右到左开始判断解			析，如果为不可识别解析，就再往左判断
			·CVE-2013-4547 Nginx解析漏洞
			http://www.xxx.com/xx.jpg(非编码空格)\0.php
```

```文件上传漏洞
文件上传漏洞成因
	上传的文件仅经过JavaScript的验证（客户本地验证），仅客户端验证是不安全的。
	绕过验证方法：
		1、禁用js
		2、本地上传表单：不通过网站给的上传功能文件，本地构建上传表单绕过本地			JavaScript验证。
		3、Burp suite代理拦截上传
		4、删除或添加js代码
	修复方法：在服务器后端对上传的文件进行经验证。
	切记！不要信任用户上传的任何文件。
```

```上传代码过滤不严格
上传代码不严格成因
		程序员写代码的时候考虑不周全，或仅设置黑名单白名单等方式，或目录参数传递可控，或者验证方式可以被绕过等等。
	传统的验证手段：
		·没有任何验证：直接接收从客户端上传的文件（不论是否是恶意文件）。
		·js验证
		·MIME类型验证
		·后缀验证：主要验证文件名的后缀，在的代码允许的范围之内，就可以上传，否则就上传失败。
		·文件内容验证：使用gteiamgesize()函数检测，会判断文件是否是一个有效的图片文件，如果不是就会报错，
		我们可以使用文件头上传欺骗来绕过。
```

​	



